/* ══════════════════════════════
   DRAWER (bottom sheet)
   ══════════════════════════════ */

.drawer-overlay {
  position: fixed;
  inset: 0;
  z-index: 150;
  background: rgba(0,0,0,0.6);
  opacity: 0;
  pointer-events: none;
  transition: opacity .2s;
}
.drawer-overlay.show { opacity: 1; pointer-events: auto; }

.drawer {
  position: fixed;
  bottom: 0; left: 0; right: 0;
  max-height: 75vh;
  background: var(--card);
  border-top: 2px solid var(--accent3);
  border-radius: 14px 14px 0 0;
  transform: translateY(100%);
  transition: transform .3s ease;
  display: flex;
  flex-direction: column;
  z-index: 160;
}
.drawer-overlay.show .drawer { transform: translateY(0); }

.drawer-handle {
  width: 36px; height: 4px;
  background: var(--muted);
  border-radius: 2px;
  margin: 8px auto 0;
  flex-shrink: 0;
}

.drawer-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 8px 16px;
  border-bottom: 1px solid var(--border);
  flex-shrink: 0;
}

.drawer-title {
  font-weight: 600;
  font-size: 12px;
  color: var(--accent2);
  letter-spacing: 0.8px;
}

.drawer-actions { display: flex; gap: 6px; align-items: center; }

.drawer-body {
  overflow-y: auto;
  flex: 1;
  min-height: 0;
  -webkit-overflow-scrolling: touch;
}

.drawer-widget { display: none; padding: 14px 16px; }
.drawer-widget.active { display: block; }

/* ══════════════════════════════
   SHARED COMPONENTS
   ══════════════════════════════ */

/* Buttons */
button {
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-family: var(--font);
  font-size: 11px;
  font-weight: 600;
  padding: 6px 14px;
  letter-spacing: 0.5px;
  transition: all .15s;
  touch-action: manipulation;
  min-height: 36px;
}

.btn-green {
  background: var(--accent-dim);
  color: var(--accent2);
  border: 1px solid var(--accent3);
}
.btn-green:hover { background: var(--btn-hover); color: var(--accent); }

.btn-red {
  background: var(--red-dim);
  color: var(--red);
  border: 1px solid #5a1a1a;
}
.btn-red:hover { background: #5a1a1a; }

.btn-ghost {
  background: transparent;
  color: var(--muted);
  border: 1px solid var(--border);
}
.btn-ghost:hover { color: var(--accent2); border-color: var(--accent3); }
.usage-period-btn.active { color: var(--accent); border-color: var(--accent); text-shadow: var(--glow-sm); }

.btn-sm  { min-height: 28px; padding: 3px 10px; font-size: 10px; }
.btn-xs  { min-height: 20px; padding: 1px 6px; font-size: 10px; line-height: 1.2; }

/* Badge inline */
.badge { font-size: 9px; font-weight: 700; letter-spacing: 0.5px; border-radius: 3px;
         padding: 1px 5px; white-space: nowrap; border: 1px solid; }
.badge-red    { color: var(--red,#f04);   border-color: var(--red,#f04); }
.badge-green  { color: var(--accent);     border-color: var(--accent); }
.badge-amber  { color: var(--amber,#fa0); border-color: var(--amber,#fa0); }
.badge-muted  { color: var(--muted);      border-color: var(--border); }

/* Tracker widget */
.tracker-item { border: 1px solid var(--border); border-radius: 4px; padding: 8px 10px;
                margin-bottom: 6px; transition: opacity .2s; }
.tracker-item.tracker-closed { opacity: 0.45; }
.tracker-item-head { display: flex; align-items: center; gap: 5px; flex-wrap: wrap; }
.tracker-title { flex: 1; font-size: 11px; color: var(--text); min-width: 60px; }
.tracker-item-actions { display: flex; gap: 4px; margin-left: auto; }
.tracker-body-text { font-size: 10px; color: var(--muted); margin-top: 4px; white-space: pre-wrap; }
.tracker-item-meta { font-size: 9px; color: var(--muted); margin-top: 4px; opacity: 0.6; }

/* Mono block */
.mono-block {
  background: var(--bg2);
  border: 1px solid var(--border);
  border-radius: 6px;
  padding: 10px 12px;
  font-family: var(--font);
  font-size: 11px;
  line-height: 1.7;
  color: var(--text2);
  max-height: 200px;
  overflow-y: auto;
  white-space: pre-wrap;
  word-break: break-word;
  -webkit-overflow-scrolling: touch;
}

/* Placeholder */
.widget-placeholder {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 10px;
  padding: 24px 12px;
  color: var(--muted);
  font-size: 11px;
  text-align: center;
  min-height: 60px;
}
.widget-placeholder .ph-icon { font-size: 24px; opacity: 0.5; }

.no-items {
  color: var(--muted);
  font-size: 11px;
  text-align: center;
  padding: 16px;
}

/* Token grid */
.token-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 7px; margin-bottom: 10px; }
.token-item { background: var(--bg2); border: 1px solid var(--border); border-radius: 6px; padding: 10px; text-align: center; }
.token-label { font-size: 9px; color: var(--muted); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 3px; }
.token-value { font-size: 15px; font-weight: 700; color: var(--amber); text-shadow: 0 0 6px rgba(255,176,0,0.3); }

/* Cron */
.cron-list { display: flex; flex-direction: column; gap: 6px; }
.cron-item { background: var(--bg2); border: 1px solid var(--border); border-radius: 6px; padding: 8px 12px; display: flex; align-items: flex-start; gap: 10px; }
.cron-schedule { font-size: 10px; color: var(--cyan); white-space: nowrap; min-width: 90px; padding-top: 1px; }
.cron-cmd { font-size: 11px; color: var(--text2); overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
.cron-desc { font-size: 10px; color: var(--muted); margin-top: 2px; }

/* ── Modals ── */
.modal-overlay {
  position: fixed; inset: 0;
  background: rgba(0,0,0,0.75);
  display: flex; align-items: center; justify-content: center;
  z-index: 200;
  opacity: 0; pointer-events: none;
  transition: opacity .2s;
}
.modal-overlay.show { opacity: 1; pointer-events: auto; }

.modal-box {
  background: var(--card);
  border: 1px solid var(--border2);
  border-radius: 10px;
  padding: 24px;
  max-width: 340px;
  width: 90%;
  text-align: center;
  box-shadow: var(--glow-md);
}

.modal-wide {
  max-width: 90%;
  width: 900px;
  max-height: 90vh;
  text-align: left;
  padding: 16px;
}

.modal-wide-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 8px;
  font-size: 10px;
  color: var(--muted);
  text-transform: uppercase;
  letter-spacing: 1px;
}

.modal-title { font-size: 14px; font-weight: 700; color: var(--accent); margin-bottom: 8px; text-shadow: var(--glow-text); }
.modal-text { font-size: 12px; color: var(--text2); margin-bottom: 20px; line-height: 1.6; }
.modal-btns { display: flex; gap: 10px; justify-content: center; }

/* Help modal */
.help-modal-box {
  background: var(--card);
  border: 1px solid var(--accent3);
  border-radius: 10px;
  width: min(720px, 95vw);
  max-height: 88vh;
  display: flex;
  flex-direction: column;
  box-shadow: var(--glow-md);
}
.help-modal-header { display: flex; justify-content: space-between; align-items: center; padding: 12px 16px; border-bottom: 1px solid var(--border2); font-size: 11px; font-weight: 700; letter-spacing: 1.5px; color: var(--accent); flex-shrink: 0; }
.help-modal-body { overflow-y: auto; padding: 12px 16px 16px; display: flex; flex-direction: column; gap: 14px; }
.help-section { border: 1px solid var(--border); border-radius: 8px; padding: 12px 14px; }
.help-section-title { font-size: 9px; font-weight: 700; letter-spacing: 1.5px; color: var(--muted); margin-bottom: 8px; }
.help-table { display: flex; flex-direction: column; gap: 5px; }
.help-row { display: flex; align-items: baseline; gap: 8px; font-size: 11px; flex-wrap: wrap; }
.help-badge { font-size: 9px; font-weight: 700; letter-spacing: 1px; border: 1px solid; border-radius: 3px; padding: 1px 5px; white-space: nowrap; flex-shrink: 0; }
.help-label { color: var(--accent); font-weight: 700; white-space: nowrap; flex-shrink: 0; min-width: 80px; }
.help-kw { color: var(--text2); font-size: 11px; flex: 1; }
.help-mode { font-size: 9px; color: var(--muted); white-space: nowrap; flex-shrink: 0; margin-left: auto; }
.help-mode.loop { color: #ffaa00; }

/* Reboot overlay */
.reboot-overlay { position: fixed; inset: 0; background: var(--bg); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 300; opacity: 0; pointer-events: none; transition: opacity .3s; gap: 16px; }
.reboot-overlay.show { opacity: 1; pointer-events: auto; }
.reboot-spinner { width: 40px; height: 40px; border: 3px solid var(--border2); border-top-color: var(--accent); border-radius: 50%; animation: spin 1s linear infinite; }
.reboot-text { font-size: 13px; color: var(--accent2); }
.reboot-status { font-size: 11px; color: var(--muted); }

/* Toast */
#toast {
  position: fixed;
  bottom: calc(70px + var(--safe-bot));
  right: 16px;
  background: var(--card);
  border: 1px solid var(--accent3);
  border-radius: 6px;
  padding: 10px 16px;
  font-size: 12px;
  color: var(--accent2);
  box-shadow: var(--glow-md);
  opacity: 0;
  transform: translateY(8px);
  transition: all .25s;
  pointer-events: none;
  z-index: 999;
}
#toast.show { opacity: 1; transform: translateY(0); }

/* Scrollbar */
::-webkit-scrollbar { width: 3px; height: 3px; }
::-webkit-scrollbar-track { background: var(--bg2); }
::-webkit-scrollbar-thumb { background: var(--border2); border-radius: 2px; }

/* ── Prompt Select ── */
.prompt-select {
  font-family: var(--font);
  font-size: 11px;
  background: var(--bg2);
  color: var(--muted);
  border: 1px solid var(--border);
  border-radius: 4px;
  padding: 2px 6px;
  max-width: 140px;
  cursor: pointer;
}
.prompt-select:focus { border-color: var(--accent3); color: var(--accent); outline: none; }
.prompt-select option { background: var(--bg2); color: var(--text); }

/* ── Sigil Indicator (Fase 38 → 44) ── */
.sigil-indicator {
  display: flex;
  align-items: center;
  gap: 5px;
  margin-left: 8px;
  font-size: 9px;
  letter-spacing: 0.8px;
  color: var(--muted);
  cursor: pointer;
}
.sigil-indicator[data-state="HAPPY"] .sigil-label,
.sigil-indicator[data-state="PROUD"] .sigil-label { color: var(--accent); }
.sigil-indicator[data-state="THINKING"] .sigil-label,
.sigil-indicator[data-state="WORKING"] .sigil-label { color: var(--cyan); }
.sigil-indicator[data-state="CURIOUS"] .sigil-label { color: var(--amber); }
.sigil-indicator[data-state="ALERT"] .sigil-label { color: var(--amber); }
.sigil-indicator[data-state="ERROR"] .sigil-label { color: var(--red); }

/* ── Memory toggle ── */
.mem-on  { color: var(--accent) !important; border-color: var(--accent) !important; text-shadow: var(--glow-sm); }
.mem-off { color: var(--muted) !important;  border-color: var(--border) !important; }

/* ── Help tip ── */
.help-tip {
  display: inline-block;
  font-size: 9px;
  color: var(--muted);
  border: 1px solid var(--border);
  border-radius: 50%;
  width: 14px; height: 14px;
  text-align: center;
  line-height: 14px;
  cursor: help;
  vertical-align: middle;
  margin-left: 4px;
}
.help-tip:hover { color: var(--accent); border-color: var(--accent); }

/* ── Animations ── */
@keyframes pulse { 0%, 100% { opacity: 1 } 50% { opacity: .4 } }
@keyframes blink { 0%, 80%, 100% { opacity: .2 } 40% { opacity: 1 } }
@keyframes spin { to { transform: rotate(360deg); } }
